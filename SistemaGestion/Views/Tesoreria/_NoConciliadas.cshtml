@model List<SistemaGestion.Models.fnSencillosTiendaNoConciliados_Result>

<div class="container shadow-lg p-3 mb-5 mt-5 bg-body rounded">
    <div class="row">
        <div class="col-lg-12">
            <div class="mt-3 mb-2 mr-1 float-right ">
                <button type="button" id="btnSendData" class="btn btn-sm btn-danger btn-block">
                    <i class="fa fa-bell"></i> Generar Alertas<span class="glyphicon glyphicon-arrow-right"></span>
                </button>
            </div>
            <table id="tbReporte" class="display" cellspacing="0" width="100%">
                <thead>
                    <tr>
                        <th class="text-center">Tienda</th>
                        <th class="text-center">Total</th>
                        <th class="text-center">Banco</th>
                        <th class="text-center">DiaLiberacion</th>
                        <th class="text-center">DiaEntrega</th>
                        <th class="text-center">FechaInicio</th>
                        <th class="text-center">FechaFin</th>
                        <th class="text-center">Estado</th>


                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>@item.idtienda</td>
                            <td>@item.NuevoTotal</td>
                            <td>@item.Banco</td>
                            <td>@item.DiaLiberacion</td>
                            <td>@item.DiaEntrega</td>
                            <td>@item.FechaInicio.Value.ToString("dd-MM-yyyy")</td>
                            <td>@item.FechaFin.Value.ToString("dd-MM-yyyy")</td>
                            <td class="bg-danger text-white">Sin Conciliar</td>





                        </tr>
                    }
                </tbody>

            </table>
        </div>
    </div>

</div>

<script>
    $(document).ready(function () {
        $('table.display').DataTable({
            responsive: true,
             "language": {
                   url: "@Url.Content("~/Content/datatable/js/datatable_spanish.json")"
               }
        });

         $(function (){
             $("#btnSendData").click(function () {
                event.preventDefault();
                var result = confirm("Desea enviar Alertas?");
                if (result){
                    $('#cargal').modal('show');
                    var url = "@Url.Action("Alertas", "Tesoreria")";
                    var manejarErrorAjax = "Eror";
                    var Fecha = $("#Fecha").val();
                    var data = { Fecha: Fecha};
                    $.post(url, data).done(function (res) {
                        if (res.error == false) {
                           
                            setTimeout(carga, 3000);
                            /* setTimeout(CerrarVistaP, 10000);*/
                            setTimeout(mostrarMensaje, 4000);
                            setTimeout(bajaModal, 6000);
                            function carga() {

                                $("#cargal").modal('hide');

                            };
                            //function CerrarVistaP() {
                            //    $('#modal').modal('hide');
                            //};
                            function bajaModal() {
                                $('#cargarMensajes').modal('hide');
                                $('#modal').modal('hide');


                            };

                            function mostrarMensaje() {
                                $("#cargarMensajes").modal('show');
                                $('#mensajeLoad').html(res.respuesta);

                            };
                        }
                        else {
                            setTimeout(carga, 3000);
                            setTimeout(mostrarMensaje, 4000);
                            setTimeout(bajaModal, 6000);
                            function carga() {
                                $("#cargal").modal('hide');
                                //$("#cargarMensajes").modal('show');
                                //$('#mensajeLoad').html(r.respuesta);
                            };
                            function bajaModal() {

                                $("#cargarMensajes").modal('hide');

                            };

                            function mostrarMensaje() {
                                $("#cargarMensajes").modal('show');
                                $('#mensajeLoad').html(res.respuesta);

                            };
                        }


                    }).fail(manejarErrorAjax);

                }
            });

        })

    });

</script>

