@model SistemaGestion.Models.ViewModels.MatchConManualEFOView

<div class="modal-dialog" role="document">
    <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Montos ZQ</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
            <div class="row">
                @using (Html.BeginForm("InsertarConciliacionM", "CuadraturaEFO", FormMethod.Post, new { id = "AgregarConciliacionManual", role = "form", enctype = "multipart/form-data" }))
                {
                <div class="col-sm-12">

                    @Html.HiddenFor(x => x.FI.Id)


                    <input type="hidden" id="txtIdPersona" />
                    <div class="form-group">
                        <label for="txtNombre">Monto:</label>
                        @Html.TextBoxFor(x => x.FI.Importe_ML, new { @class = "form-control form-control-sm model", @readonly = "readonly" })
                        @*<input type="text" class="form-control form-control-sm model" id="Autorizador" name="Fecha" autocomplete="off" value="@Model.AutorizadorTbk">*@
                    </div>
                    <div class="form-group">
                        <label for="txtNombre">Centro:</label>
                        @Html.TextBoxFor(x => x.FI.Centro, new { @class = "form-control form-control-sm model", @readonly = "readonly" })
                        @*<input type="text" class="form-control form-control-sm model" id="Autorizador" name="Fecha" autocomplete="off" value="@Model.AutorizadorTbk">*@
                    </div>
                    <div class="form-group">
                        <label for="txtApellidos">FechaDocumento:</label>
                        @Html.TextBoxFor(x => x.FI.Fecha_Documento, new { @class = "form-control form-control-sm model", @readonly = "readonly" })
                        @*<input type="text" class="form-control form-control-sm model" id="Monto" name="Fecha" autocomplete="off" value="@Model.MontoTbk">*@
                    </div>

                </div>
                    <label for="txtNombre">MontosZQ</label>
                    @Html.DropDownListFor(x => x.idZQ, Model.ZQLista.OrderBy(z => z.Text),"Seleccione ZQ...", new { @class = "form-control", name = "Id2" })
                }
            </div>



        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-danger" data-dismiss="modal">Cerrar</button>
            <button type="submit" class="btn btn-primary" id="btcarga">Conciliar</button>
        </div>
    </div>
</div>

<script>
     $(function () {
         $("#btcarga").click(function () {
                event.preventDefault();
                var result = confirm("Desea Conciliar?");
                if (result) {
                    $('#cargal').modal('show');
                    var url = "@Url.Action("InsertarConciliacionM", "CuadraturaEFO")";
                    var manejarErrorAjax = "Eror";
                    var Id1 = $('#idZQ').find('option:selected').val();
                    console.log(Id1);
                   
                    var Id = $('#FI_Id').val();
                    console.log(Id);
                    var data = { Id: Id, Id1: Id1 };
                    $.post(url, data).done(function (res) {
                        if (res.error == false) {
                    
                            setTimeout(carga, 3000);
                            setTimeout(mostrarMensaje, 4000);
                            setTimeout(bajaModal, 6000);
                            bajarModalConciliacion();
                            setTimeout(MostrarLista, 7000);
                      

                            //setTimeout(bajarModalConciliacion, 8000);
                            function carga() {
                                $("#cargal").modal('hide');
                                //$("#cargarMensajes").modal('show');
                                //$('#mensajeLoad').html(r.respuesta);
                            };
                            function bajaModal() {

                                $("#cargarMensajes").modal('hide');
                                $("#totales").modal('hide');

                            };

                            function mostrarMensaje() {
                                $("#cargarMensajes").modal('show');
                                $('#mensajeLoad').html(res.respuesta);

                            };

                        /*    function Cargar*/


                        } else {

                            setTimeout(carga, 3000);
                            setTimeout(mostrarMensaje, 4000);
                            setTimeout(bajaModal, 6000);


                            function carga() {
                                $("#cargal").modal('hide');
                                //$("#cargarMensajes").modal('show');
                                //$('#mensajeLoad').html(r.respuesta);
                            };
                            function bajaModal() {

                                $("#cargarMensajes").modal('hide');

                            };

                            function mostrarMensaje() {
                                $("#cargarMensajes").modal('show');
                                $('#mensajeLoad').html(res.respuesta);

                            };

                        }
                        //$('.modal-backdrop').remove();

                    }).fail(manejarErrorAjax);

                }
            });

     })

    function MostrarLista() {
        location.reload();
        console.log("Entre a la Mostrar");
        $('#cargal').modal('show');
        var url = "@Url.Action("ConciliacionManual", "CuadraturaEFO")";
        var manejarErrorAjax = "Eror";
        //var parametros = $("#AgregarConciliacionManual").serialize();
        //var tienda = $("#Local").val();
        //var Fecha = $("#Fecha").val();
        //console.log('Entro en la vista de listas')
        //console.log(tienda);
      /*  var data = { Fecha: Fecha, local: tienda };*/
        $.get(url).done(function (data) {
            setTimeout(bajar, 1000);
            setTimeout(Subir, 2000);

            function bajar() {
                $('#cargal').modal('hide');

            }
            function Subir() {
                $('#totales').html(data);
                $('#totales').show();
            }

        }).fail(manejarErrorAjax);

    }
</script>

